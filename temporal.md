CREATE TABLE `curso` (
  `id_curso` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `id_maestro` int(10) unsigned DEFAULT NULL,
  `id_categoria` int(10) unsigned DEFAULT NULL,
  `id_area` int(11) DEFAULT NULL,
  `id_universidad` int(10) unsigned DEFAULT NULL,
  `id_facultad` int(10) unsigned DEFAULT NULL,
  `id_carrera` int(10) unsigned DEFAULT NULL,
  `codigo_curso` varchar(20) DEFAULT NULL,
  `nombre_curso` varchar(150) NOT NULL,
  `descripcion` text DEFAULT NULL,
  `objetivos` text DEFAULT NULL,
  `prerequisitos` text DEFAULT NULL,
  `duracion_horas` smallint(5) unsigned NOT NULL,
  `creditos_constancia` decimal(5,2) DEFAULT 0.00,
  `horas_teoria` smallint(5) unsigned DEFAULT NULL,
  `horas_practica` smallint(5) unsigned DEFAULT NULL,
  `nivel` enum('basico','intermedio','avanzado') NOT NULL,
  `modalidad` enum('presencial','mixto','virtual','virtual_autogestiva','virtual_mixta','virtual-presencial') NOT NULL DEFAULT 'virtual',
  `tipo_costo` enum('gratuito','pago') NOT NULL DEFAULT 'gratuito',
  `costo` decimal(10,2) DEFAULT NULL,
  `cupo_maximo` smallint(5) unsigned DEFAULT 30,
  `fecha_inicio` date NOT NULL,
  `fecha_fin` date NOT NULL,
  `horario` varchar(100) DEFAULT NULL,
  `link_clase` varchar(500) DEFAULT NULL,
  `estatus_curso` enum('planificado','abierto','en_curso','finalizado','cancelado') DEFAULT 'planificado',
  `aprobado_universidad` tinyint(1) DEFAULT 0,
  `aprobado_sedeq` tinyint(1) DEFAULT 0,
  `fecha_aprobacion_universidad` timestamp NULL DEFAULT NULL,
  `fecha_aprobacion_sedeq` timestamp NULL DEFAULT NULL,
  `observaciones_aprobacion` text DEFAULT NULL,
  `fecha_creacion` timestamp NULL DEFAULT current_timestamp(),
  `fecha_actualizacion` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `caracterizacion` text DEFAULT NULL,
  `intencion_didactica` text DEFAULT NULL,
  `evaluacion_competencias` text DEFAULT NULL,
  `propositos` text DEFAULT NULL,
  `perfil_egreso` text DEFAULT NULL,
  `competencias_genericas` text DEFAULT NULL,
  `competencias_especificas` text DEFAULT NULL,
  `evaluacion` text DEFAULT NULL,
  `metodologia` text DEFAULT NULL,
  `notas_adicionales` text DEFAULT NULL,
  `clave_asignatura` varchar(50) DEFAULT NULL,
  `competencias_desarrollar` text DEFAULT NULL,
  `competencias_previas` text DEFAULT NULL,
  `proyecto_fundamentacion` text DEFAULT NULL,
  `proyecto_planeacion` text DEFAULT NULL,
  `proyecto_ejecucion` text DEFAULT NULL,
  `proyecto_evaluacion` text DEFAULT NULL,
  `id_convocatoria` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id_curso`),
  UNIQUE KEY `uk_codigo_curso` (`codigo_curso`),
  KEY `idx_maestro` (`id_maestro`),
  KEY `idx_categoria` (`id_categoria`),
  KEY `idx_estatus` (`estatus_curso`),
  KEY `idx_fechas` (`fecha_inicio`,`fecha_fin`),
  KEY `idx_nivel` (`nivel`),
  KEY `idx_aprobaciones` (`aprobado_universidad`,`aprobado_sedeq`),
  KEY `idx_fecha_creacion` (`fecha_creacion`),
  KEY `idx_curso_universidad` (`id_maestro`,`estatus_curso`),
  KEY `idx_curso_filtros` (`id_categoria`,`nivel`,`fecha_inicio`),
  KEY `fk_curso_universidad` (`id_universidad`),
  KEY `fk_curso_facultad` (`id_facultad`),
  KEY `fk_curso_carrera` (`id_carrera`),
  KEY `fk_curso_convocatoria` (`id_convocatoria`),
  CONSTRAINT `fk_curso_carrera` FOREIGN KEY (`id_carrera`) REFERENCES `carreras` (`id_carrera`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_categoria` FOREIGN KEY (`id_categoria`) REFERENCES `categoria_curso` (`id_categoria`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_convocatoria` FOREIGN KEY (`id_convocatoria`) REFERENCES `convocatorias` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_facultad` FOREIGN KEY (`id_facultad`) REFERENCES `facultades` (`id_facultad`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_maestro` FOREIGN KEY (`id_maestro`) REFERENCES `maestro` (`id_maestro`) ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_universidad` FOREIGN KEY (`id_universidad`) REFERENCES `universidad` (`id_universidad`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `chk_fechas_curso` CHECK (`fecha_fin` >= `fecha_inicio`),
  CONSTRAINT `chk_duracion_horas` CHECK (`duracion_horas` > 0 and `duracion_horas` <= 1000),
  CONSTRAINT `chk_cupo_maximo` CHECK (`cupo_maximo` > 0 and `cupo_maximo` <= 1000)
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;


CREATE TABLE `subgrupos_operadores` (
  `id_subgrupo` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre_subgrupo` varchar(150) NOT NULL,
  `descripcion` text DEFAULT NULL,
  `fecha_creacion` timestamp NULL DEFAULT current_timestamp(),
  `fecha_actualizacion` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id_subgrupo`),
  UNIQUE KEY `uk_nombre_subgrupo` (`nombre_subgrupo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

CREATE TABLE `curso_habilidades_clave` (
  `id_curso` int(10) unsigned NOT NULL,
  `id_habilidad` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id_curso`,`id_habilidad`),
  KEY `fk_curso_habilidades_curso` (`id_curso`),
  KEY `fk_curso_habilidades_habilidad` (`id_habilidad`),
  CONSTRAINT `fk_curso_habilidades_curso` FOREIGN KEY (`id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_curso_habilidades_habilidad` FOREIGN KEY (`id_habilidad`) REFERENCES `habilidades_clave` (`id_habilidad`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

CREATE TABLE `habilidades_clave` (
  `id_habilidad` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre_habilidad` varchar(150) NOT NULL,
  `descripcion` text DEFAULT NULL,
  `fecha_creacion` timestamp NULL DEFAULT current_timestamp(),
  `fecha_actualizacion` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id_habilidad`),
  UNIQUE KEY `uk_nombre_habilidad` (`nombre_habilidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;
